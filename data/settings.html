<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Styles -->
        <link rel="stylesheet" type="text/css" href="/style/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="/style/sticky-footer-navbar.css">
        <link rel="stylesheet" type="text/css" href="/style/style.css">
        <style>
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            @media (min-width: 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
        </style>

        <title>PIXELIX</title>
        <link rel="shortcut icon" type="image/png" href="/favicon.png" />
    </head>
    <body class="d-flex flex-column h-100">
        <header>
            <!-- Fixed navbar -->
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <a class="navbar-brand" href="/index.html">
                    <img src="/images/LogoSmall.png" alt="PIXELIX" />
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="/index.html">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/display.html">Display</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="pluginsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Plugins</a>
                            <div class="dropdown-menu" aria-labelledby="pluginsDropdown">
                                <a class="dropdown-item" href="/plugins/CountdownPlugin.html">Countdown Plugin</a>
                                <a class="dropdown-item" href="/plugins/DatePlugin.html">Date Plugin</a>
                                <a class="dropdown-item" href="/plugins/DateTimePlugin.html">DateTime Plugin</a>
                                <a class="dropdown-item" href="/plugins/FirePlugin.html">Fire Plugin</a>
                                <a class="dropdown-item" href="/plugins/GameOfLifePlugin.html">GameOfLife Plugin</a>
                                <a class="dropdown-item" href="/plugins/GruenbeckPlugin.html">Gruenbeck Plugin</a>
                                <a class="dropdown-item" href="/plugins/IconTextLampPlugi.html">IconTextLamp Plugin</a>
                                <a class="dropdown-item" href="/plugins/IconTextPlugin.html">IconText Plugin</a>
                                <a class="dropdown-item" href="/plugins/JustTextPlugin.html">JustText Plugin</a>
                                <a class="dropdown-item" href="/plugins/RainbowPlugin.html">Rainbow Plugin</a>
                                <a class="dropdown-item" href="/plugins/SunrisePlugin.html">Sunrise Plugin</a>
                                <a class="dropdown-item" href="/plugins/SysMsgPlugin.html">SysMsg Plugin</a>
                                <a class="dropdown-item" href="/plugins/TestPlugin.html">Test Plugin</a>
                                <a class="dropdown-item" href="/plugins/TimePlugin.html">Time Plugin</a>
                                <a class="dropdown-item" href="/plugins/WifiStatusPlugin.html">WifiStatus Plugin</a>
                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/settings.html">Settings</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/update.html">Update</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="developmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>
                            <div class="dropdown-menu" aria-labelledby="developmentDropdown">
                                <a class="dropdown-item" href="/info.html">Info</a>
                                <a class="dropdown-item" href="/debug.html">Debug</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/about.html">About</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="flex-shrink-0">
            <div class="container">
                <h1 class="mt-5">Settings</h1>
                <p>Note, some settings may only be applied after a system restart.</p>
                <p id="settings"></p>
            </div>
        </main>
  
        <!-- Footer -->
        <footer class="footer mt-auto py-3">
            <div class="container">
                <hr />
                <span class="text-muted">(C) 2019 - 2020 by Andreas Merkle (web@blue-andi.de)</span><br />
                <span class="text-muted"><a href="https://github.com/BlueAndi/esp-rgb-led-matrix/blob/master/LICENSE">MIT License</a></span>
            </div>
        </footer>

        <!-- jQuery, Popper.js, and Bootstrap JS -->
        <script type="text/javascript" src="/js/jquery-3.5.1.slim.min.js"></script>
        <script type="text/javascript" src="/js/popper.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>

        <!-- Custom javascript -->
        <script>
            var data = ~SETTINGS_DATA~;

            function store(id) {
                var formData    = new FormData();
                var xhr         = new XMLHttpRequest();
                var input       = $("#" + id);

                if ("checkbox" === input.attr("type")) {
                    formData.append(input.attr("name"), input.is(":checked"));
                } else {
                    formData.append(input.attr("name"), input.val());
                }

                xhr.open("POST", "/settings.html");
                xhr.onload = function() {
                    var jsonRsp = JSON.parse(xhr.response);

                    if (0 === jsonRsp.status) {
                        alert("Info: " + jsonRsp.info);
                    } else {
                        alert("Error: " + jsonRsp.error);
                    }
                };
                xhr.send(formData);
            }

            $(document).ready(function() {
                var index       = 0;
                var keyIndex    = 0;
                var keys        = null;
                var label       = null;
                var formGroup   = null;
                var inputField  = null;
                var button      = null;

                for(index = 0; index < data.length; ++index) {
                    keys = Object.keys(data[index].input);

                    label = $("<label>").attr("for", "for-" + index).attr("class", "form-label").text(data[index].title);

                    inputField = $("<input>").attr("class", "form-control").attr("id", "setting-" + index).attr("placeholder", "");
                    for(keyIndex = 0; keyIndex < keys.length; ++keyIndex) {
                        $(inputField).attr(keys[keyIndex], data[index].input[keys[keyIndex]]);
                    }

                    button = $("<button>").attr("class", "btn btn-primary").attr("onclick", "store(\"setting-" + index + "\");").text("Store");

                    formGroup = $("<div>").attr("class", "form-group").append(label).append(inputField).append(button);

                    $("#settings").append(formGroup);
                }
            });
        </script>
    </body>
</html>